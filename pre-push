#!/bin/sh
echo "Running pre-push checks..."

# Get the script directory
SCRIPT_DIR=$(dirname "$0")

# Check React frontend build
echo "Checking React frontend..."
cd "$SCRIPT_DIR/frontend" || exit 1
npm run build
if [ $? -ne 0 ]; then
  echo "‚ùå React: Frontend build failed. Push aborted."
  exit 1
else
  echo "‚úÖ React: Frontend build succeeded."
fi

# Check FastAPI backend syntax
echo "Checking FastAPI backend..."
cd "$SCRIPT_DIR/backend/routes" || exit 1

# Check Python syntax for main.py
python -m py_compile main.py
if [ $? -ne 0 ]; then
  echo "‚ùå FastAPI: Syntax error in main.py. Push aborted."
  exit 1
else
  echo "‚úÖ FastAPI: main.py syntax check passed."
fi

# Check if FastAPI app can be imported (dry run)
cp "$SCRIPT_DIR/test_import.py" ./test_import.py
python test_import.py
rm -f test_import.py
if [ $? -ne 0 ]; then
  echo "‚ùå FastAPI: App import failed. Push aborted."
  exit 1
else
  echo "‚úÖ FastAPI: App import check passed."
fi

echo "üéâ All checks passed. Proceeding with push."
exit 0
